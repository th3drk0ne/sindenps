<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
<meta name="color-scheme" content="dark" />
<title>SindenPS</title>
<style>
/* Base */
html { box-sizing: border-box; }
*, *::before, *::after { box-sizing: inherit; }
body { background:#000; color:#fff; font-family: system-ui, -apple-system, sans-serif; margin:0; }
input, select, button { font-size:16px; }
.page { width:100%; margin:0 auto; }

/* Header */
header { background:#000; padding:20px; border-bottom:4px solid #c00; position:sticky; top:0; z-index:10; }
.header-row { display:flex; align-items:center; justify-content:space-between; gap:12px; }
.logo { height:40px; width:auto; display:block; }
.tabs { display:flex; flex-wrap:wrap; gap:10px; }
.tabs button { background:#222; color:#fff; border:1px solid #c00; padding:10px 14px; border-radius:6px; cursor:pointer; }
.tabs button:hover { background:#c00; }

.panel-title { color:#f33; font-size:22px; text-align:center; margin:16px 0; }

/* Services */
.service-row { background:#111; margin:10px 16px; padding:12px; border-left:6px solid #c00; border-radius:6px; }
.service-buttons { display:flex; flex-wrap:wrap; gap:8px; }
.service-buttons button { border:none; padding:10px 12px; border-radius:6px; cursor:pointer; font-weight:bold; }
.log-box { background:#000; border:1px solid #c00; padding:10px; display:none; max-height:300px; overflow:auto; border-radius:6px; }
.log-content { white-space:pre-wrap; font-family:monospace; font-size:13px; color:#ccc; }

/* Config */
.config-toolbar { display:flex; flex-wrap:wrap; gap:10px; margin:10px 16px; }
.config-row { display:flex; align-items:center; gap:8px; margin:8px 0; }
.config-row label { width:260px; }
.config-row input { flex:1; padding:10px; background:#000; border:1px solid #444; color:#fff; }
.config-path { text-align:left; }

@media (min-width:769px) { .page { max-width:none; } }

@media (max-width:768px) {
  .log-content { font-size:11px; }
  .header-row { flex-wrap:nowrap; }
  .tabs { flex:1; gap:6px; justify-content:flex-end; }
  .tabs button { flex:1; min-width:0; padding:12px; }
  .service-buttons { flex-direction:column; }
  .service-buttons button { width:100%; }
  .config-row { flex-direction:column; align-items:flex-start; }
  .config-row input { width:100%; }
}
</style>
</head>
<body>
<div class="page">
<header>
  <div class="header-row">
     <img src="/logo.png" class="logo" alt="SindenPS Logo">
    <nav class="tabs">
      <button onclick="showTab('sindenlog')">Sinden Log</button>
      <button onclick="showTab('services')">Services</button>
      <button onclick="showTab('config')">Configuration</button>
    </nav>
  </div>
</header>

<!-- SINDEN LOG TAB -->
<section id="tab-sindenlog" style="padding:10px; display:block;">
  <h2 class="panel-title">LightGun.Service Log</h2>
  <div class="log-box" style="display:block; max-height:500px;">
    <pre id="sinden-log-content" class="log-content">Loading…</pre>
  </div>
</section>

<!-- SERVICES TAB -->
<section id="service-panel" style="display:none;">
  <h2 class="panel-title">Service Monitor</h2>

  <div class="service-row" id="service-lightgun">
    <div class="service-name">lightgun.service</div>
    <div class="service-status">loading…</div>
    <div class="service-buttons">
      <button onclick="serviceAction('lightgun.service','start')">Start</button>
      <button onclick="serviceAction('lightgun.service','stop')">Stop</button>
      <button onclick="serviceAction('lightgun.service','restart')">Restart</button>
      <button class="log-toggle" onclick="toggleLogs(event,'lightgun.service')">Show Logs</button>
    </div>
    <div class="log-box" id="logs-lightgun"><pre class="log-content">Loading…</pre></div>
  </div>

  <div class="service-row" id="service-lightgun-monitor">
    <div class="service-name">lightgun-monitor.service</div>
    <div class="service-status">loading…</div>
    <div class="service-buttons">
      <button onclick="serviceAction('lightgun-monitor.service','start')">Start</button>
      <button onclick="serviceAction('lightgun-monitor.service','stop')">Stop</button>
      <button onclick="serviceAction('lightgun-monitor.service','restart')">Restart</button>
      <button class="log-toggle" onclick="toggleLogs(event,'lightgun-monitor.service')">Show Logs</button>
    </div>
    <div class="log-box" id="logs-lightgun-monitor"><pre class="log-content">Loading…</pre></div>
  </div>

  <!-- SYSTEM POWER ACTIONS -->
  <div class="service-row" id="system-actions">
    <div class="service-name">System</div>
    <div id="system-status" class="service-status"></div>
    <div class="service-buttons">
      <button onclick="confirmSystemAction('reboot')" style="background:#444; color:#fff;">Reboot OS</button>
      <button onclick="confirmSystemAction('shutdown')" style="background:#a00; color:#fff;">Shutdown OS</button>
    </div>
  </div>
</section>

<!-- CONFIG TAB -->
<section id="tab-config" style="display:none; padding:10px;">
  <h2 class="panel-title">Sinden LightGun Driver Configuration</h2>

  <div class="config-toolbar">
    <div class="group">
      <label>Platform:</label>
      <select id="platform-select"><option value="ps2">PlayStation 2</option><option value="ps1">PlayStation 1</option></select>
    </div>
    <div class="group">
      <label>Profile:</label>
      <select id="profile-select"><option value="">(none)</option></select>
    </div>
    <div class="group">
      <button id="btn-activate-profile">Activate Profile</button>
      <button id="btn-save-profile">Save as Profile</button>
      <label><input type="checkbox" id="chk-restore-mode"> Restore</label>
    </div>
    <span id="config-file-path" class="config-path"></span>
    <span id="config-status" class="config-status-inline"></span>
    <button id="save-restart">Save & Restart</button>
  </div>

  <div class="config-panels">
    <div class="config-card"><div class="service-name">Player 1</div><div id="p1-form" class="config-form"></div></div>
    <div class="config-card"><div class="service-name">Player 2</div><div id="p2-form" class="config-form"></div></div>
  </div>
</section>

<!-- BACKUP MODAL -->
<div id="backup-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.7); z-index:1000;">
  <div class="dialog" style="background:#111; border:1px solid #c00; width:min(760px,90vw); margin:10vh auto; padding:16px;">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <div class="service-name">Restore Backup</div>
      <button onclick="closeBackupModal()">Close</button>
    </div>
    <div id="backup-list-status"></div>
    <div id="backup-list" style="max-height:50vh; overflow:auto; border:1px solid #444; padding:8px;"></div>
  </div>
</div>

<script>
function showTab(name){
  document.getElementById('service-panel').style.display = name==='services' ? 'block':'none';
  document.getElementById('tab-sindenlog').style.display = name==='sindenlog' ? 'block':'none';
  document.getElementById('tab-config').style.display = name==='config' ? 'block':'none';
}

async function serviceAction(name, action){
  await fetch(`/api/service/${name}/${action}`, { method:'POST' });
}

function toggleLogs(evt, svc){
  const box = document.getElementById('logs-'+svc.replace('.service',''));
  if(box.style.display==='block'){
    box.style.display='none'; evt.target.textContent='Show Logs';
  } else {
    box.style.display='block'; evt.target.textContent='Hide Logs';
  }
}

function confirmSystemAction(action){
  const msg = action==='shutdown' ? 'Are you sure you want to SHUT DOWN?' : 'Reboot system now?';
  if(!confirm(msg)) return;
  systemAction(action);
}

async function systemAction(action){
  const s = document.getElementById('system-status');
  s.textContent = action==='reboot' ? 'Rebooting…' : 'Shutting down…';
  await fetch(`/api/system/${action}`, { method:'POST' });
  s.textContent = 'Command sent…';
}
</script>

</div>
</body>
</html>