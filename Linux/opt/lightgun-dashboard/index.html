<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Lightgun Dashboard</title>
<style>
body {
  background-color: black;
  color: white;
  font-family: sans-serif;
  margin: 0;
  padding: 0;
}
header {
  background-color: black;
  padding: 20px;
  border-bottom: 4px solid red;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.header-left {
  display: flex;
  align-items: center;
  gap: 15px;
}
.logo {
  height: 48px;
  width: auto;
}
.header-title {
  font-size: 32px;
  font-weight: bold;
}
.tabs button {
  background: #222;
  color: white;
  border: 1px solid red;
  padding: 8px 16px;
  margin-right: 10px;
  cursor: pointer;
}
.tabs button:hover {
  background: red;
}
.panel-title {
  color: red;
  font-size: 24px;
  font-weight: bold;
  text-align: center;
  margin-top: 20px;
}
.service-row {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  background-color: #111;
  margin: 10px 20px;
  padding: 10px;
  border-left: 6px solid red;
}
.service-name {
  font-size: 20px;
  font-weight: bold;
}
.service-status {
  font-size: 16px;
  color: lime;
  margin: 5px 0;
}
.service-buttons {
  display: flex;
  gap: 10px;
  margin-top: 8px;
}
.service-buttons button {
  padding: 6px 12px;
  font-size: 14px;
  font-weight: bold;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}
.service-buttons button:nth-child(1) {
  background-color: lightgray;
  color: black;
}
.service-buttons button:nth-child(2) {
  background-color: gold;
  color: black;
}
.service-buttons button:nth-child(3) {
  background-color: red;
  color: white;
}
.log-toggle {
  background-color: #333;
  color: white;
}
.log-box {
  width: 100%;
  background-color: #000;
  border: 1px solid red;
  margin-top: 10px;
  padding: 10px;
  display: none;
  max-height: 300px;
  overflow-y: auto;
}
.log-content {
  white-space: pre-wrap;
  font-family: monospace;
  font-size: 13px;
  color: #ccc;
}
</style>
</head>
<body>

<header>
  <div class="header-left">
    <img src="logo.png" class="logo">
    <div class="header-title">Lightgun Dashboard</div>
  </div>

  <nav class="tabs">
    <button onclick="showTab('services')">Services</button>
    <button onclick="showTab('sindenlog')">Sinden Log</button>
  </nav>
</header>

<div id="service-panel">
  <h2 class="panel-title">SERVICE MONITOR</h2>

  <div class="service-row" id="service-lightgun">
    <span class="service-name">lightgun.service</span>
    <span class="service-status">loading…</span>
    <div class="service-buttons">
      <button onclick="serviceAction('lightgun.service','start')">Start</button>
      <button onclick="serviceAction('lightgun.service','stop')">Stop</button>
      <button onclick="serviceAction('lightgun.service','restart')">Restart</button>
      <button class="log-toggle" onclick="toggleLogs('lightgun.service')">Show Logs</button>
    </div>
    <div class="log-box" id="logs-lightgun">
      <pre class="log-content">Loading…</pre>
    </div>
  </div>

  <div class="service-row" id="service-lightgun-monitor">
    <span class="service-name">lightgun-monitor.service</span>
    <span class="service-status">loading…</span>
    <div class="service-buttons">
      <button onclick="serviceAction('lightgun-monitor.service','start')">Start</button>
      <button onclick="serviceAction('lightgun-monitor.service','stop')">Stop</button>
      <button onclick="serviceAction('lightgun-monitor.service','restart')">Restart</button>
      <button class="log-toggle" onclick="toggleLogs('lightgun-monitor.service')">Show Logs</button>
    </div>
    <div class="log-box" id="logs-lightgun-monitor">
      <pre class="log-content">Loading…</pre>
    </div>
  </div>
</div>

<div id="tab-sindenlog" style="display:none; padding:20px;">
  <h2 class="panel-title">SINDEN LOG</h2>
  <div class="log-box" style="display:block; max-height:500px;">
    <pre id="sinden-log-content" class="log-content">Loading…</pre>
  </div>
</div>

<script>
function showTab(name) {
  document.getElementById("service-panel").style.display =
    name === "services" ? "block" : "none";

  document.getElementById("tab-sindenlog").style.display =
    name === "sindenlog" ? "block" : "none";

  if (name === "sindenlog") loadSindenLog();
}

async function refreshServices() {
  const res = await fetch("/api/services");
  const data = await res.json();

  for (const [name, status] of Object.entries(data)) {
    const row = document.getElementById("service-" + name.replace(".service",""));
    if (!row) continue;
    const statusEl = row.querySelector(".service-status");
    statusEl.textContent = status;
    statusEl.className = "service-status " + status;
  }
}

async function serviceAction(name, action) {
  await fetch(`/api/service/${name}/${action}`, { method: "POST" });
  refreshServices();
}

async function loadLogs(service) {
  const box = document.getElementById("logs-" + service.replace(".service",""));
  const content = box.querySelector(".log-content");

  const res = await fetch(`/api/logs/${service}`);
  const data = await res.json();

  content.textContent = data.logs || "No logs available";
}

function toggleLogs(service) {
  const box = document.getElementById("logs-" + service.replace(".service",""));
  const btn = event.target;

  if (box.style.display === "block") {
    box.style.display = "none";
    btn.textContent = "Show Logs";
  } else {
    box.style.display = "block";
    btn.textContent = "Hide Logs";
    loadLogs(service);
  }
}

async function loadSindenLog() {
  const res = await fetch("/api/sinden-log");
  const data = await res.json();

  const box = document.getElementById("sinden-log-content");
  box.textContent = data.logs;

  box.parentElement.scrollTop = box.parentElement.scrollHeight;
}

setInterval(() => {
  ["lightgun.service", "lightgun-monitor.service"].forEach(s => {
    const box = document.getElementById("logs-" + s.replace(".service",""));
    if (box.style.display === "block") loadLogs(s);
  });

  if (document.getElementById("tab-sindenlog").style.display === "block") {
    loadSindenLog();
  }
}, 3000);

setInterval(refreshServices, 3000);
refreshServices();
</script>

</body>
</html>
