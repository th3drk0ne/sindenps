<!-- Updated index.html with Restore Backup UI -->
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Dashboard</title>
<style>
/* (styles unchanged from user version except modal additions) */
body { background-color:black; color:white; font-family:sans-serif; margin:0; padding:0; }
header { background-color:black; padding:20px; border-bottom:4px solid red; display:flex; justify-content:space-between; align-items:center; }
.header-left { display:flex; align-items:center; gap:15px; }
.logo { height:48px; width:auto; }
.header-title { font-size:32px; font-weight:bold; }
.tabs button { background:#222; color:white; border:1px solid red; padding:8px 16px; margin-right:10px; cursor:pointer; }
.tabs button:hover { background:red; }
.panel-title { color:red; font-size:24px; font-weight:bold; text-align:center; margin-top:20px; }
.service-row { display:flex; flex-direction:column; align-items:flex-start; background:#111; margin:10px 20px; padding:10px; border-left:6px solid red; }
.service-name { font-size:20px; font-weight:bold; }
.service-status { font-size:16px; color:lime; margin:5px 0; }
.service-buttons { display:flex; gap:10px; margin-top:8px; flex-wrap:wrap; }
.service-buttons button { padding:6px 12px; font-size:14px; font-weight:bold; border:none; border-radius:4px; cursor:pointer; }
.service-buttons button:nth-child(1) { background:lightgray; color:black; }
.service-buttons button:nth-child(2) { background:gold; color:black; }
.service-buttons button:nth-child(3) { background:red; color:white; }
.log-toggle { background:#333; color:white; }
.log-box { width:99%; background:#000; border:1px solid red; margin-top:10px; padding:10px; display:none; max-height:300px; overflow-y:auto; }
.log-content { white-space:pre-wrap; font-family:monospace; font-size:13px; color:#ccc; }
.config-toolbar { display:flex; flex-wrap:wrap; align-items:center; gap:10px; margin:10px 20px; }
.config-row { display:flex; align-items:center; gap:8px; margin:6px 0; }
.config-row label { width:260px; color:#ccc; font-size:14px; }
.config-row input { flex:0 0 50%; max-width:50%; padding:6px; background:#000; color:#fff; border:1px solid #444; }
.config-path { color:#888; font-size:12px; margin-left:10px; }
.config-status-inline { color:#ccc; margin-left:auto; text-align:right; }
.btn-secondary { background:#444; color:white; font-weight:bold; padding:8px 14px; border:none; border-radius:4px; cursor:pointer; }
.btn-tertiary { background:#222; color:white; font-weight:bold; padding:8px 14px; border:1px solid #444; border-radius:4px; cursor:pointer; }
.btn-danger { background:#a00; color:white; font-weight:bold; padding:8px 14px; border:none; border-radius:4px; cursor:pointer; }
</style>
</head>
<body>
<header>
 <div class="header-left">
   /logo.png
   <div class="header-title"></div>
 </div>
 <nav class="tabs">
   <button onclick="showTab('sindenlog')">Sinden Log</button>
   <button onclick="showTab('services')">Services</button>
   <button onclick="showTab('config')">Configuration</button>
 </nav>
</header>

<!-- CONFIG TAB with Restore Backup toggle -->
<div id="tab-config" style="display:none; padding:10px;">
 <h2 class="panel-title">Sinden LightGun Driver Configuration</h2>
 <div class="config-toolbar">
   <label for="platform-select">Platform:</label>
   <select id="platform-select">
     <option value="ps2" selected>PlayStation 2</option>
     <option value="ps1">PlayStation 1</option>
   </select>

   <label for="profile-select">Profile:</label>
   <select id="profile-select">
     <option value="">(none)</option>
   </select>

   <button id="btn-activate-profile" class="btn-danger">Activate Profile</button>
   <button id="btn-save-profile" class="btn-secondary">Save as Profile</button>

   <!-- NEW CHECKBOX -->
   <label style="display:inline-flex; align-items:center; gap:6px; color:#ccc; margin-left:6px;">
     <input type="checkbox" id="chk-restore-mode" /> Restore from backup
   </label>

   <span id="config-file-path" class="config-path"></span>
   <span id="config-status" class="config-status-inline"></span>
   <button id="save-restart" class="btn-danger">Save & Restart</button>
 </div>

 <div style="display:flex; gap:16px; flex-wrap:wrap;">
   <div style="flex:1 1 460px; background:#111; border-left:6px solid red; padding:12px;">
     <div class="service-name">Player 1</div>
     <div id="p1-form" class="config-form" style="margin-top:8px;"></div>
   </div>
   <div style="flex:1 1 460px; background:#111; border-left:6px solid red; padding:12px;">
     <div class="service-name">Player 2</div>
     <div id="p2-form" class="config-form" style="margin-top:8px;"></div>
   </div>
 </div>
</div>

<!-- NEW BACKUP RESTORE MODAL -->
<div id="backup-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.7); z-index:1000;">
 <div style="background:#111; border:1px solid red; border-left:6px solid red; width:min(780px,92vw); margin:10vh auto; padding:16px;">
   <div style="display:flex; justify-content:space-between; align-items:center;">
     <div class="service-name">Restore from Backup</div>
     <button id="backup-modal-close" class="btn-tertiary">Close</button>
   </div>
   <div id="backup-list-status" class="config-status-inline" style="margin:10px 0;"></div>
   <div id="backup-list" style="max-height:50vh; overflow:auto; background:#000; border:1px solid #444; padding:8px;"></div>
 </div>
</div>

<script>
/* ---- Restore Mode Toggle ---- */
function isRestoreMode(){ return document.getElementById('chk-restore-mode').checked; }
function updateActivateButtonLabel(){
 const btn=document.getElementById('btn-activate-profile');
 btn.textContent=isRestoreMode()? 'Restore Backup' : 'Activate Profile';
}
document.getElementById('chk-restore-mode').addEventListener('change',updateActivateButtonLabel);

/* ---- Modal ---- */
function openBackupModal(){ document.getElementById('backup-modal').style.display='block'; }
function closeBackupModal(){ document.getElementById('backup-modal').style.display='none'; }
document.getElementById('backup-modal-close').onclick=closeBackupModal;

async function listBackups(platform){
 const res=await fetch(`/api/config/backups?platform=${platform}`);
 return await res.json();
}

async function restoreBackup(platform, filename){
 const res=await fetch('/api/config/backup/restore',{
   method:'POST', headers:{'Content-Type':'application/json'},
   body:JSON.stringify({platform, filename})
 });
 return await res.json();
}

function humanDate(e){ return new Date(e*1000).toLocaleString(); }

function renderBackupList(list, platform){
 const box=document.getElementById('backup-list');
 const status=document.getElementById('backup-list-status');
 box.innerHTML=''; status.textContent='';

 if(!list.length){ status.textContent='No backups found.'; return; }

 list.forEach(b=>{
   const row=document.createElement('div');
   row.style.cssText='display:flex; justify-content:space-between; align-items:center; padding:8px; border-bottom:1px solid #222;';

   const meta=document.createElement('div');
   meta.innerHTML=`<div style="color:#fff;font-weight:bold">${b.name}</div>
                   <div style="color:#888;font-size:12px">${humanDate(b.mtime)} Â· ${b.size} bytes</div>`;

   const act=document.createElement('button');
   act.className='btn-danger'; act.textContent='Restore this backup';
   act.onclick=async()=>{
     if(!confirm(`Restore backup ${b.name}?`))return;
     const s=document.getElementById('config-status');
     s.textContent='Restoring...';
     const r=await restoreBackup(platform,b.name);
     if(!r.ok){ s.textContent='Restore failed: '+r.error; return; }
     s.textContent='Restored. Restarting service...';
     await fetch('/api/service/lightgun.service/restart',{method:'POST'});
     s.textContent='Backup restored.';
     closeBackupModal();
   };

   const right=document.createElement('div'); right.appendChild(act);
   row.appendChild(meta);
   row.appendChild(right);
   box.appendChild(row);
 });
}

/* ---- Activate / Restore Button ---- */
document.getElementById('btn-activate-profile').onclick=async()=>{
 const platform=document.getElementById('platform-select').value;
 const profile=document.getElementById('profile-select').value;
 if(isRestoreMode()){
   document.getElementById('backup-list-status').textContent='Loading backups...';
   openBackupModal();
   const data=await listBackups(platform);
   if(data.ok) renderBackupList(data.backups,platform);
   else document.getElementById('backup-list-status').textContent='Error loading backups';
   return;
 }
 // normal activate profile
 await fetch('/api/config/profile/load',{method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({platform,name:profile})});
};
</script>
</body>
</html>