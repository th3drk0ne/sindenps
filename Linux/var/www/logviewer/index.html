
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <!-- Critical for correct sizing on iPhone/iPad -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sinden Log Viewer</title>

  <style>
    html {
      /* Prevent iOS from shrinking text */
      -webkit-text-size-adjust: 100%;
    }

    /* ------------------ THEME VARIABLES ------------------ */
    :root {
      --accent-color: #ff1a1a;        /* GunCon Red (default) */
      --header-bg: #000000;
      --log-bg: #111111;
      --text-color: #ffffff;
      --font-main: Verdana, sans-serif;
    }

    /* PS1 GRAY THEME */
    .theme-ps1 {
      --accent-color: #c0c0c0;
      --header-bg: #1e1e1e;
      --log-bg: #2b2b2b;
      --text-color: #ffffff;
    }

    /* ------------------ GLOBAL LAYOUT ------------------ */
    body {
      background: #1a1a1a;
      margin: 0;
      color: var(--text-color);
      font-family: Impact, "Arial Black", sans-serif;

      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
      transition: background 0.3s ease;
    }

    /* ------------------ HEADER ------------------ */
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 18px;
      background: var(--header-bg);
      position: relative;
      z-index: 1;

      color: var(--text-color);
      font-family: var(--font-main);
    }

    .header-title {
      display: flex;
      align-items: center;
      gap: 14px;
      font-size: 1.8rem;
      position: relative;
      z-index: 2;
    }

    .header-title img {
      height: 60px;
    }

    /* Theme selector dropdown */
    .theme-select {
      font-family: var(--font-main);
      font-size: 0.9rem;
      padding: 4px 8px;
      border-radius: 4px;
      background: #222;
      color: #fff;
      border: 1px solid #444;
    }

    /* GunCon underline bar */
    header::after {
      content: "";
      position: absolute;
      bottom: 0;
      left: 0;
      height: 6px;
      width: 100%;
      background: var(--accent-color);
      z-index: 0;
      transition: background 0.3s ease;
    }

    /* GunCon angled slash */
    header::before {
      content: "";
      position: absolute;
      bottom: 0;
      left: 160px;
      width: 40px;
      height: 6px;
      background: var(--accent-color);
      transform: skewX(-30deg);
      z-index: 0;
      transition: background 0.3s ease;
    }

    /* ------------------ LOG WINDOW ------------------ */
    #log {
      flex: 1;
      overflow-y: auto;
      background: var(--log-bg);
      padding: 12px 14px;
      white-space: pre-wrap;
      color: var(--text-color);
      font-family: var(--font-main);
      font-size: 0.95rem;
      transition: background 0.3s ease;
    }

    /* ------------------ MOBILE ------------------ */
    @media (max-width: 600px) {

      header {
        padding: 8px 10px;
      }

      .header-title {
        font-size: 1.6rem;   /* bigger mobile title */
        gap: 10px;
      }

      .header-title img {
        height: 36px;        /* smaller logo for mobile */
      }

      header::before {
        left: 95px;
        width: 30px;
      }

      #log {
        font-size: 1.25rem;  /* larger for readability */
        line-height: 1.55;
      }
    }

    /* ------------------ ULTRAWIDE ------------------ */
    @media (min-width: 1600px) {
      header {
        padding: 16px 40px;
      }

      .header-title {
        font-size: 2.2rem;
        gap: 20px;
      }

      .header-title img {
        height: 80px;
      }

      header::before {
        left: 220px;
        width: 60px;
      }

      #log {
        font-size: 1.05rem;
      }
    }

    /* ------------------ SUPER ULTRAWIDE ------------------ */
    @media (min-width: 2200px) {
      header {
        padding: 20px 60px;
      }

      .header-title {
        font-size: 2.6rem;
      }

      .header-title img {
        height: 90px;
      }

      #log {
        font-size: 1.15rem;
        line-height: 1.4;
      }
    }
  </style>

  <script>
    /* Apply saved theme BEFORE first paint to avoid flash */
    (function applySavedThemeEarly() {
      try {
        // Try cookie first
        const cookieMatch = document.cookie.match(/(?:^|; )theme=([^;]*)/);
        let saved = cookieMatch ? decodeURIComponent(cookieMatch[1]) : null;

        // Fallback to localStorage
        if (!saved && window.localStorage) {
          saved = localStorage.getItem('themeChoice');
        }

        if (saved === 'theme-ps1') {
          document.documentElement.classList.add('theme-ps1');
        } else {
          // default (GunCon Red) → ensure no leftover class
          document.documentElement.classList.remove('theme-ps1');
        }
      } catch (_) {
        /* ignore */
      }
    })();
  </script>
</head>


<body>

  <header>
    <div class="header-title">
      <img src="logo.png" alt="Sinden Lightgun Logo">
      Sinden Lightgun Service Log
    </div>

    <!-- Theme Selector Dropdown -->
    <select id="themeSwitcher" class="theme-select" aria-label="Theme selector">
      <option value="default">GunCon Red</option>
      <option value="theme-ps1">PS1 Gray</option>
    </select>
  </header>

  <div id="log" aria-live="polite">Loading…</div>

  <script>
    /* ------------ COOKIE & THEME UTILS ------------ */

    // Set cookie with 400 days max-age (Chrome iOS honors max-age; SameSite/Lax by default)
    function setThemeCookie(value) {
      const encoded = encodeURIComponent(value);
      // Path=/ makes it available across the site if you host this at a path
      document.cookie = `theme=${encoded}; max-age=${60 * 60 * 24 * 400}; path=/`;
    }

    function getThemeCookie() {
      const m = document.cookie.match(/(?:^|; )theme=([^;]*)/);
      return m ? decodeURIComponent(m[1]) : null;
    }

    function applyTheme(value) {
      // toggle class on <html> so CSS variables apply everywhere
      if (value === 'theme-ps1') {
        document.documentElement.classList.add('theme-ps1');
      } else {
        document.documentElement.classList.remove('theme-ps1');
        value = 'default'; // normalize
      }
      // persist to cookie & localStorage
      setThemeCookie(value);
      try { localStorage.setItem('themeChoice', value); } catch (_) {}
    }

    // Initialize selector from persisted value
    (function initThemeSelector() {
      const sel = document.getElementById('themeSwitcher');
      let current = getThemeCookie();
      if (!current) {
        try { current = localStorage.getItem('themeChoice'); } catch (_) {}
      }
      if (current === 'theme-ps1') {
        sel.value = 'theme-ps1';
      } else {
        sel.value = 'default';
      }
      sel.addEventListener('change', function () {
        applyTheme(this.value);
      });
    })();

    /* ------------ LOG REFRESH ------------ */
    async function fetchLog() {
      try {
        const res = await fetch('sinden.log', { cache: 'no-store' });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const text = await res.text();
        const el = document.getElementById('log');
        el.textContent = text || '(empty)';
        el.scrollTop = el.scrollHeight;
      } catch (e) {
        document.getElementById('log').textContent =
          'Failed to load log: ' + e.message;
      }
    }
    fetchLog();
    setInterval(fetchLog, 2000);
  </script>

</body>
</html>
